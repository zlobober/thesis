\chapter{Наблюдения относительно структуры основной теоремы}

На протяжении ближайших четырёх глав (вплоть до рассмотрения обобщения оптимизированных алгоритмов на взвешенный случай) будем предполагать, что граф невзвешенный, то есть, что $w(e) = 1$ для любого ребра $e \in E$. В таких обстоятельствах длина любого пути численно совпадает с количеством рёбер в нём.

Пункт а теоремы \ref{main_theorem} не вызывает никаких вопросов и задаёт основание для рекурсивной формулы: действительно, для вырожденного случая, когда пары терминалов схлопываются в одиночные вершины, ответ на вопрос задачи зависит исключительно от того, совпадут ли эти вершины или нет.

Пункт б теоремы \ref{main_theorem} тоже не вызывает особых сложностей. Применим индуктивный аргумент: пусть, например, $s_1 \notin L(s_2, t_2)$, $s_1 \neq s_2$ и при этом $2DSP(x, t_1, s_2, t_2) = 1$ для некоторого $x \in F(s_1, t_1)$. Рассмотрим пару кратчайших путей $(P_1', P_2)$, существующую для двух пар терминалов $(x, t_1)$ и $(s_2, t_2)$. Покажем, как можно расширить первый путь $P_1'$ до пути $P_1$, соединяющего $s_1$ и $t_1$ кратчайшим образом и не пересекающегося с $P_2$ (что докажет, что $2DSP(s_1, t_1, s_2, t_2)$ действительно есть $1$).

Положим $P_1 = \{s_1\} \sqcup P_1'$. Заметим, что $P_1' \cap P_2 = \varnothing$, а $s_1 \notin L(s_2, t_2) \supseteq P_2$. Значит, действительно, $P_1 \cap P_2 = \varnothing$. С другой стороны, если $P_1, P_2$ --- искомая пара кратчайших путей, соединяющих $s_1$ с $t_1$ и $s_2$ с $t_2$, то можно взять в качестве $x$ первую вершину, следующую за $s_1$ в пути $P_1$, и получить таким образом, что $2DSP(x, t_1, s_2, t_2)$, так как $P_1' = P_1 \sm \{s_1\}$ и $P_2$ --- пара кратчайших непересекающихся путей, что доказывает часть б теоремы.

Части в теоремы \ref{main_theorem} описывает те случаи, когда применить индуктивный аргумент, описанный выше, не удаётся. В работе \cite{ET} путём скурпулёзного рассмотрения случаев показывается, что значение $2DSP(s_1, t_1, s_2, t_2)$ можно определить, взглянув на значения предиката $2DSP$ на 18 группах четвёрок вершин, компоненты которых совпадают с соответствующими компонентами четвёрки $(s_1, t_1, s_2, t_2)$, либо смежны с ними определённым образом. Отметим ряд важных свойств формул выше.

\begin{proposition} \label{q2_structure}
В каждом выражении, составляющем $Q_2$, ровно два аргумента совпадают с соответствующими аргументами предиката в левой части, а оставшиеся два аргумента соответствуют множествам вершин, смежных с соответствующими аргументами предиката в левой части. Более того, для каждой пары терминалов $(s_i, t_i)$ ровно один из терминалов остаётся нетронутым, а другой заменяется на множество смежных с ним вершин, находящихся ближе к противоположному терминалу.
\end{proposition}

\begin{proposition}
Оба выражения, составляющие $Q_4$, содержат в качестве каждого из аргументов множество смежных вершин с соответствующим аргументом предиката в левой части. 
\end{proposition}

Назовём четвёрку $(s_1, t_1, s_2, t_2)$ зависящей от четвёрки $(x, y, u, v)$, если в рекурсивной формуле для $2DSP(s_1, t_1, s_2, t_2)$ в правой части встречается значение $2DSP(x, y, u, v)$ (как составная часть одного из выражений либо в $Q_2$, либо в $Q_4$). Будем записывать факт зависимости таких четвёрок как $(s_1, t_1, s_2, t_2) \succ (x, y, u, v)$.

\begin{proposition}
Отношение $\succ$ не содержит циклов. Иными словами, с использованием теоремы \ref{main_theorem} возможно вычислить значения предиката $2DSP$ во всех точках с использованием метода динамического программирования.
\end{proposition}
\begin{proof}
В пункте а теоремы \ref{main_theorem} в правой части формулы для $2DSP(s_1, t_1, s_2, t_2)$ отсутствуют какие-либо другие значения предиката, поэтому такие четвёрки $(s_1, t_1, s_2, t_2)$ ни от чего не зависят.

Теперь заметим такое свойство пунктов б и в теоремы \ref{main_theorem}, что если четвёрка $(s_1, t_1, s_2, t_2) \succ (x, y, u, v)$, то $l(x, y) \leq l(s_1, t_1)$, $l(u, v) \leq l(s_2, t_2)$ и в хотя бы одном из этих двух неравеств знак строгий. В $Q_2$ это верно в силу предложения \ref{q2_structure} о структуре формул, составляющих $Q_2$, а в $Q_4$ это верно по той причине, что всегда выполняются соотношение $l(x, y) = l(s_1, t_1) - 2$ и $l(u, v) = l(s_2, t_2) - 2$.
\end{proof}

Прежде чем записать полностью алгоритм для вычисления всех значений предиката $2DSP$, установим ещё один факт про четвёрки, для которых реализуется случай в теоремы \ref{main_theorem}.

\begin{proposition} \label{eql}
В жёсткой четвёрке $(s_1, t_1, s_2, t_2)$ расстояния между парами терминалов совпадают, то есть, $l(s_1, t_1) = l(s_2, t_2)$.
\end{proposition}
\begin{proof} ~

$s_1, t_1 \in L(s_2, t_2) \Rightarrow l(s_1, s_2) + l(s_2, t_1) = l(s_1, t_2) + l(t_2, t_1)$, т.к. оба выражения равны $l(s_1, t_1)$.

$s_2, t_2 \in L(s_1, t_1) \Rightarrow l(s_2, s_1) + l(s_1, t_2) = l(s_2, t_1) + l(t_1, t_2)$, т.к. оба выражения равны $l(s_2, t_2)$.

Путём сложения двух последних равенств и сокращения одинаковых слагаемых, получим соотношение $l(s_1, s_2) = l(t_2, t_1)$. 

Заменяя $l(s_1, s_2)$ на $l(t_2, t_1)$ в первом равенстве, получим также, что $l(s_2, t_1) = l(s_1, t_2)$.

Наконец, заметим, что $l(s_1, t_1) = l(s_1, s_2) + l(s_2, t_1) = l(t_1, t_2) + l(s_2, t_1) = l(s_2, t_2)$, что завершает доказательство предложения.
\end{proof}

