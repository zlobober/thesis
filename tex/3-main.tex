\chapter{Основная часть}
\label{cha:main}

Начнём с формулировки основного результата работы \cite{ET} в отношении неориентированного вершинно-непересекающегося варианта задачи 2DSP. Введём ряд вспомогательных определений. Здесь и далее $G = (V, E)$ --- неориентированный невзвешенный (с единичными длинами рёбер) граф без петель.

\begin{definition} 
Пусть $x, y \in V$ --- две вершины, находящиеся в одной компоненте связности. Тогда $l(x, y)$ это длина кратчайшего пути из $x$ в $y$ (в рёбрах). Для вершин $x$ и $y$ из разных компонент связности будем полагать значение $l(x, y)$ равным бесконечности.
\end{definition}

В частности, для любой вершины $x \in V$ верно соотношение $l(x, x) = 0$.

\begin{definition} 
Пусть $x, y \in V$ --- две вершины графа. Тогда $L(x, y) \subseteq V$ --- это множество всех вершин $v$, лежащих на хотя бы одном кратчайшем пути из $x$ в $y$.
\end{definition}

Легко видеть, что $v \in L(x, y) \Leftrightarrow l(x, v) + l(v, y) = l(x, y)$. Также отметим, что для несвязных вершин $x$ и $y$ верно соотношение $L(x, y) = \varnothing$.

\begin{definition}
Пусть $x, y \in V$ --- две вершины графа. Тогда 
\begin{equation}
F(x, y) = \{v \in L(x, y) \mid (x, v) \in E\}.
\end{equation}
Иными словами, $F(x, y)$ --- множество всевозможных вершин, следующих за $x$ на каком-либо кратчайшем пути из $x$ в $y$. 
\end{definition}

Для нашего удобства нам также пригодится аналогичное обозначение для множества вершин, следующих на $x$ одновременно и на каком-то кратчайшем пути в $y$, и на каком-то кратчайшем пути в $z$. Введём альтернативный вариант функции $F$, принимающий три аргумента, а не два:

\begin{definition}
Пусть $x, y, z \in V$ --- три вершины графа. Тогда
\begin{equation}
F(x, y, z) = F(x, y) \cap F(x, z)
\end{equation}
\end{definition}

\begin{definition}
Пусть $s_1, t_1, s_2, t_2 \in V$ --- четыре вершины графа. Тогда обозначим за $2DSP(s_1, t_1, s_2, t_2)$ логическую величину, равную $1$, если существуют два вершинно-непересекающихся кратчайших пути $P_1$ и $P_2$ между парами терминалов $(s_1, t_1)$ и $(s_2, t_2)$ соответственно, и $0$ в противном случае.
\end{definition}

\begin{definition}
Будем называть четвёрку вершин $(s_1, t_1, s_2, t_2)$ \textit{жёсткой}, если $s_1, t_1 \in L(s_2, t_2)$ и $s_2, t_2 \in L(s_1, t_1)$.
\end{definition}

Будем придерживаться договорённости, что вместо какого-то из аргументов предиката $2DSP$ может находиться не вершина, а множество вершин. В таком случае значение выражения будем считать логическую дизъюнкцию значений предиката $2DSP$ по всевозможным наборам значений, где на позиции, на которой в записи находится множество вершин, стоит какая-то из вершин указанного множества. Например, в соответствии с такой договорённостью верно соотношение: 

\begin{equation}
2DSP(F(s_1, t_1), t_1, s_2, t_2) = \bigvee\limits_{x \in F(s_1, t_1)} 2DSP(x, t_1, s_2, t_2).
\end{equation}

Теперь мы готовы сформулировать основной результат работы \cite{ET}:

\begin{theorem}
Для $2DSP(s_1, t_1, s_2, t_2)$ верно одно из трёх соотношений:
\begin{enumerate} 
\item Если $s_1 = t_1$, $s_2 = t_2$, то $2DSP(s_1, t_1, s_2, t_2) = 1$ если $s_1 \neq s_2$ и $0$ в противном случае.
\item Иначе, если $(s_1, t_1, s_2, t_2)$ --- нежёсткая четвёрка, то рассмотрим вершину, для которой нарушилось условие жёсткости. Не умаляя общности будем считать, что это $s_1 \notin L(s_2, t_2)$, и при этом $s_1 \neq t_1$. Тогда $2DSP(s_1, t_1, s_2, t_2) = 2DSP(F(s_1, t_1), s_2, t_2)$.
\item Иначе, положим $C = L(s_1, s_2) \cup L(s_2, t_1) \cup L(t_1, t_2) \cup L(t_2, s_1)$. Тогда $2DSP(s_1, t_1, s_2, t_2) = Q_2(s_1, t_1, s_2, t_2) \vee Q_4(s_1, t_1, s_2, t_2)$, где $Q_2$ и $Q_4$ определяются следующим образом.
\begin{align}
Q_2(s_1, t_1, s_2, t_2) =\hspace{-1cm}\\
    2DSP(&& s_1              ,&& F(t_1, s_1, s_2) ,&& s_2              ,&& F(t_2, s_2, s_1) &)~\vee \\
    2DSP(&& F(s_1, t_1, s_2) ,&& t_1              ,&& s_2              ,&& F(t_2, s_2, t_1) &)~\vee \\
    2DSP(&& s_1              ,&& F(t_1, s_1, t_2) ,&& F(s_2, t_2, s_1) ,&& t_2              &)~\vee \\
    2DSP(&& F(s_1, t_1, t_2) ,&& t_1              ,&& F(s_2, t_2, t_1) ,&& t_2              &)~\vee \\[0.4cm]
    %
    2DSP(&& F(s_1, t_1) \sm C,&& t_1              ,&& F(s_2, t_2) \sm C,&& t_2              &)~\vee \\ 
    2DSP(&& F(s_1, t_1) \sm C,&& t_1              ,&& s_2              ,&& F(t_2, s_2) \sm C&)~\vee \\ 
    2DSP(&& s_1              ,&& F(t_1, s_1) \sm C,&& F(s_2, t_2) \sm C,&& t_2              &)~\vee \\ 
    2DSP(&& s_1              ,&& F(t_1, s_1) \sm C,&& s_2              ,&& F(t_2, s_2) \sm C&)~\vee \\[0.4cm]
    %
    2DSP(&& s_1              ,&& F(t_1, s_1, s_2) ,&& s_2              ,&& F(t_2, s_2) \sm C&)~\vee \\
    2DSP(&& s_1              ,&& F(t_1, s_1, t_2) ,&& F(s_2, t_2) \sm C,&& t_2              &)~\vee \\
    2DSP(&& F(t_1, s_1, s_2) ,&& t_1              ,&& s_2              ,&& F(t_2, s_2) \sm C&)~\vee \\
    2DSP(&& F(t_1, s_1, t_2) ,&& t_1              ,&& F(s_2, t_2) \sm C,&& t_2              &)~\vee \\
    2DSP(&& s_1              ,&& F(t_1, s_1) \sm C,&& s_2              ,&& F(t_2, s_2, s_1) &)~\vee \\
    2DSP(&& F(s_1, t_1) \sm C,&& t_1              ,&& s_2              ,&& F(t_2, s_2, t_1) &)~\vee \\
    2DSP(&& s_1              ,&& F(t_1, s_1) \sm C,&& F(s_2, t_2, s_1) ,&& t_2              &)~\vee \\
    2DSP(&& F(s_1, t_1) \sm C,&& t_1              ,&& F(s_2, t_2, t_1) ,&& t_2              &) \label{eq:Q2}
\end{align}
\begin{align}
    Q_4(s_1, t_1, s_2, t_2) = \quad
        \smashoperator{\bigvee_{
        \large \substack{
            x \in F(s_1, s_2)\\ 
            y \in F(t_1, t_2)\\ 
            u \in F(s_2, t_1)\\ 
            v \in F(t_2, s_1)\\ 
            l(s_1, x) + l(x, y) + l(y, t_1) = l(s_2, t_2)\\ 
            l(s_2, u) + l(u, v) + l(v, t_2) = l(s_2, t_2)
        }
        }} 2DSP(x, y, u, v)
        \quad\quad\vee\quad\quad
        \smashoperator{\bigvee_{
        \large \substack{
            x \in F(s_1, t_2)\\ 
            y \in F(t_1, s_2)\\ 
            u \in F(s_2, s_1)\\ 
            v \in F(t_2, t_1)\\ 
            l(s_1, x) + l(x, y) + l(y, t_1) = l(s_2, t_2)\\ 
            l(s_2, u) + l(u, v) + l(v, t_2) = l(s_2, t_2)
        }
        }} 2DSP(x, y, u, v) \label{eq:Q4} \\
\end{align}
\end{theorem}

У неподготовленного читателя формулировка теоремы выше (а в особенности формулы \eqref{eq:Q2} и \eqref{eq:Q4}) могут вызвать состояние лёгкого шока, поэтому себе остановиться в этом месте и прокомментировать разные аспекты утверждения выше, чтобы по возможности развить у читателя некоторую интуицию относительно выражений, фигурирующих в правой части рекурсивной формулы.

Часть а) теоремы не вызывает никаких вопросов и задаёт основание для рекурсивной формулы: действительно, для вырожденного случая, когда пары терминалов схлопываются в одиночные вершины, ответ на вопрос задачи зависит исключительно от того, совпадут ли эти вершины или нет.

Часть б) теоремы тоже не вызывает особых сложностей. Применим индуктивный аргумент: пусть, например, $s_1 \notin L(s_2, t_2)$, $s_1 \neq s_2$ и при этом $2DSP(x, t_1, s_2, t_2) = 1$ для некоторого $x \in F(s_1, t_1)$. Рассмотрим пару кратчайших путей $(P_1', P_2)$, существующую для двух пар терминалов $(x, t_1)$ и $(s_2, t_2)$. Покажем, как можно расширить первый путь $P_1'$ до пути $P_1$, соединяющего $s_1$ и $t_1$ кратчайшим образом и не пересекающегося с $P_2$ (что докажет, что $2DSP(s_1, t_1, s_2, t_2)$ действительно есть $1$).

Положим $P_1 = \{s_1\} \sqcup P_1'$. Заметим, что $P_1' \cap P_2 = \varempty$, а $s_1 \notin L(s_2, t_2) \supseteq P_2$. Значит, действительно, $P_1 \cap P_2 = \varempty$. С другой стороны, если $P_1, P_2$ --- искомая пара кратчайших путей, соединяющих $s_1$ с $t_1$ и $s_2$ с $t_2$, то можно взять в качестве $x$ первую вершину, следующую за $s_1$ в пути $P_1$, и получить таким образом, что $2DSP(x, t_1, s_2, t_2)$, так как $P_1' = P_1 \ \{s_1\}$ и $P_2$ --- пара кратчайших непересекающихся путей, что доказывает часть б) теоремы.

Части в) теоремы описывает те случаи, когда применить индуктивный аргумент, описанный выше, не удаётся. В работе \cite{ET} путём скурпулёзного рассмотрения случаев показывается, что значение $2DSP(s_1, t_1, s_2, t_2)$ можно определить, взглянув на значения предиката $2DSP$ на 18 группах четвёрок вершин, компоненты которых совпадают с соответствующими компонентами четвёрки $(s_1, t_1, s_2, t_2)$, либо смежны с ними определённым образом. Отметим ряд важных свойств формул выше.

\begin{proposition}
В $Q_2$ сгруппированы выражения, каждое из которых является дизъюнкцией $2DSP$ по множеству из $O(|V|^2)$ вершин, а в $Q_4$ сгруппированы выражения, каждое из которых является дизъюнкцией $2DSP$ по множеству из $O(|V|^4)$ вершин.
\end{proposition}

Это напрямую следует из договорённости о том, как понимать значение выражения вида $2DSP(\cdot,\cdot,\cdot,\cdot)$, в качестве какого-то из аргументов которого подставлено множество вершин.

\begin{proposition}
В каждом выражении $Q_2$ ровно два аргумента совпадают с соответствующими аргументами предиката в левой части, а оставшиеся два аргумента соответствуют множествам вершин, смежных с соответствующими аргументами предиката в левой части. Более того, для каждой пары терминалов $(s_i, t_i)$ ровно один из терминалов остаётся нетронутым, а другой заменяется на множество смежных с ним вершин, находящихся ближе к противоположному терминалу.
\end{proposition}

\begin{proposition}
В предикате $Q_4$ оба выражения содержат в качестве каждого из аргументов множество смежных вершин с соответствующим аргументом предиката в левой части.
\end{proposition}
Заметим

Назовём четвёрку $(s_1, t_1, s_2, t_2)$ зависящей от


